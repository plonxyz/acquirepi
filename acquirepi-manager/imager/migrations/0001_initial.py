# Generated by Django 6.0.1 on 2026-01-26 21:01

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('contenttypes', '0002_remove_content_type_name'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Agent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('hostname', models.CharField(max_length=255, unique=True)),
                ('mac_address', models.CharField(max_length=17, unique=True)),
                ('ip_address', models.GenericIPAddressField()),
                ('api_token', models.CharField(blank=True, help_text='API token for agent authentication', max_length=64, null=True, unique=True)),
                ('status', models.CharField(choices=[('pending', 'Pending Approval'), ('approved', 'Approved'), ('denied', 'Denied'), ('offline', 'Offline'), ('online', 'Online'), ('imaging', 'Imaging in Progress')], default='pending', max_length=20)),
                ('is_approved', models.BooleanField(default=False)),
                ('hardware_model', models.CharField(blank=True, max_length=255, null=True)),
                ('serial_number', models.CharField(blank=True, max_length=255, null=True)),
                ('first_seen', models.DateTimeField(auto_now_add=True)),
                ('last_seen', models.DateTimeField(auto_now=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('supports_s3', models.BooleanField(default=True)),
                ('supports_nfs', models.BooleanField(default=True)),
                ('supports_disk', models.BooleanField(default=True)),
                ('cpu_percent', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('memory_percent', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('memory_total_mb', models.BigIntegerField(blank=True, null=True)),
                ('memory_used_mb', models.BigIntegerField(blank=True, null=True)),
                ('disk_percent', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('disk_total_gb', models.BigIntegerField(blank=True, null=True)),
                ('disk_used_gb', models.BigIntegerField(blank=True, null=True)),
                ('temperature_celsius', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('network_sent_mb', models.BigIntegerField(blank=True, help_text='Total MB sent since boot', null=True)),
                ('network_recv_mb', models.BigIntegerField(blank=True, help_text='Total MB received since boot', null=True)),
                ('available_disks', models.JSONField(blank=True, default=list, help_text='List of available disks detected on agent')),
                ('ssh_username', models.CharField(default='pi', help_text='SSH username for remote access', max_length=100)),
                ('ssh_password', models.CharField(blank=True, help_text='SSH password (stored in plaintext - use with caution)', max_length=255, null=True)),
                ('ssh_key_path', models.CharField(blank=True, help_text='Path to private SSH key file on manager server', max_length=500, null=True)),
                ('pending_command', models.CharField(choices=[('none', 'No Command'), ('reboot', 'Reboot'), ('shutdown', 'Shutdown')], default='none', help_text='Pending command to execute on agent', max_length=20)),
                ('pending_command_at', models.DateTimeField(blank=True, help_text='When the pending command was issued', null=True)),
            ],
            options={
                'ordering': ['-last_seen'],
            },
        ),
        migrations.CreateModel(
            name='SSHKey',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Descriptive name for this SSH key', max_length=255, unique=True)),
                ('public_key', models.TextField(help_text="SSH public key (will be added to agent's authorized_keys)")),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='EvidenceHandlingEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('event_type', models.CharField(choices=[('received', 'Evidence Received'), ('examined', 'Physical Examination'), ('photographed', 'Photographed'), ('sealed', 'Evidence Sealed'), ('write_blocker_tested', 'Write Blocker Tested'), ('imaging_started', 'Imaging Started'), ('imaging_completed', 'Imaging Completed'), ('hash_verified', 'Hash Verified'), ('qa_reviewed', 'QA Reviewed'), ('checked_out', 'Checked Out'), ('checked_in', 'Checked In'), ('transferred', 'Custody Transferred'), ('stored', 'Stored in Evidence'), ('returned', 'Returned to Owner'), ('destroyed', 'Disposed/Destroyed'), ('note', 'Note/Observation')], max_length=50)),
                ('event_timestamp', models.DateTimeField(auto_now_add=True)),
                ('location', models.CharField(blank=True, help_text='Where event occurred', max_length=255)),
                ('event_description', models.TextField(help_text='Detailed description of event')),
                ('witness_names', models.TextField(blank=True, help_text='Non-system user witnesses')),
                ('photos_taken', models.JSONField(default=list, help_text='Photos taken during event')),
                ('forms_completed', models.JSONField(default=list, help_text='Forms/documents completed')),
                ('transfer_reason', models.TextField(blank=True)),
                ('evidence_condition', models.CharField(blank=True, help_text='Condition at time of event', max_length=255)),
                ('notes', models.TextField(blank=True)),
                ('record_hash', models.CharField(blank=True, editable=False, help_text='SHA256 hash of this record for tamper detection', max_length=64)),
                ('previous_hash', models.CharField(blank=True, editable=False, help_text='Hash of previous event in chain for this job', max_length=64)),
                ('performed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('transferred_from', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='evidence_transferred_from', to=settings.AUTH_USER_MODEL)),
                ('transferred_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='evidence_transferred_to', to=settings.AUTH_USER_MODEL)),
                ('witnesses', models.ManyToManyField(blank=True, related_name='witnessed_events', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Evidence Handling Event',
                'verbose_name_plural': 'Evidence Handling Events',
                'ordering': ['event_timestamp'],
            },
        ),
        migrations.CreateModel(
            name='DigitalSignature',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('signer_role', models.CharField(help_text='Role of signer (e.g., Evidence Custodian, Examiner)', max_length=100)),
                ('signer_name', models.CharField(help_text='Full name of signer for the record', max_length=255)),
                ('signature_data', models.TextField(help_text='Base64 encoded signature image')),
                ('signed_at', models.DateTimeField(auto_now_add=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, help_text='IP address of signer', null=True)),
                ('signature_hash', models.CharField(help_text='SHA256 hash of signature data for verification', max_length=64)),
                ('event_snapshot', models.JSONField(help_text='Snapshot of event data at time of signature')),
                ('is_verified', models.BooleanField(default=True, help_text='Whether signature verification passes')),
                ('verification_notes', models.TextField(blank=True, help_text='Notes about verification failures')),
                ('signer', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='signatures', to=settings.AUTH_USER_MODEL)),
                ('event', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='signatures', to='imager.evidencehandlingevent')),
            ],
            options={
                'verbose_name': 'Digital Signature',
                'verbose_name_plural': 'Digital Signatures',
                'ordering': ['signed_at'],
            },
        ),
        migrations.CreateModel(
            name='EvidencePhoto',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('photo', models.ImageField(help_text='Photo of evidence, device, seals, write-blocker, etc.', upload_to='evidence_photos/%Y/%m/%d/')),
                ('caption', models.CharField(blank=True, help_text='Brief description of photo', max_length=255)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('file_size', models.IntegerField(blank=True, help_text='File size in bytes', null=True)),
                ('image_width', models.IntegerField(blank=True, null=True)),
                ('image_height', models.IntegerField(blank=True, null=True)),
                ('event', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='photos', to='imager.evidencehandlingevent')),
                ('uploaded_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Evidence Photo',
                'verbose_name_plural': 'Evidence Photos',
                'ordering': ['uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='ImagingJob',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('queued', 'Queued'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('upload_method', models.CharField(choices=[('disk', 'Disk to Disk'), ('nfs', 'NFS Share')], max_length=10)),
                ('case_number', models.CharField(max_length=255)),
                ('evidence_number', models.CharField(max_length=255)),
                ('examiner_name', models.CharField(max_length=255)),
                ('description', models.TextField()),
                ('image_name', models.CharField(max_length=255)),
                ('base_path', models.CharField(default='/tmp', max_length=500)),
                ('s3_access_key', models.CharField(blank=True, max_length=255, null=True)),
                ('s3_secret_key', models.CharField(blank=True, max_length=255, null=True)),
                ('s3_server', models.CharField(blank=True, max_length=255, null=True)),
                ('s3_bucket_name', models.CharField(blank=True, max_length=255, null=True)),
                ('s3_bucket_location', models.CharField(blank=True, default='us-east-1', max_length=50, null=True)),
                ('s3_use_https', models.BooleanField(default=True)),
                ('nfs_server', models.CharField(blank=True, max_length=255, null=True)),
                ('nfs_share', models.CharField(blank=True, max_length=500, null=True)),
                ('nfs_mount_point', models.CharField(blank=True, default='/mnt/nfs-share', max_length=500, null=True)),
                ('network_ssid', models.CharField(blank=True, help_text='WiFi SSID', max_length=255, null=True)),
                ('network_password', models.CharField(blank=True, help_text='WiFi password', max_length=255, null=True)),
                ('source_device_path', models.CharField(blank=True, help_text='Device path to image (e.g., /dev/sda, /dev/nvme0n1)', max_length=255, null=True)),
                ('progress_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('acquired_bytes', models.BigIntegerField(default=0)),
                ('total_bytes', models.BigIntegerField(default=0)),
                ('transfer_speed', models.CharField(blank=True, max_length=50, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('error_message', models.TextField(blank=True, null=True)),
                ('output_path', models.CharField(blank=True, max_length=500, null=True)),
                ('image_size', models.BigIntegerField(blank=True, null=True)),
                ('source_md5', models.CharField(blank=True, help_text='MD5 hash of source device', max_length=32, null=True)),
                ('source_sha1', models.CharField(blank=True, help_text='SHA1 hash of source device', max_length=40, null=True)),
                ('source_sha256', models.CharField(blank=True, help_text='SHA256 hash of source device', max_length=64, null=True)),
                ('image_md5', models.CharField(blank=True, help_text='MD5 hash of image file', max_length=32, null=True)),
                ('image_sha1', models.CharField(blank=True, help_text='SHA1 hash of image file', max_length=40, null=True)),
                ('image_sha256', models.CharField(blank=True, help_text='SHA256 hash of image file', max_length=64, null=True)),
                ('hash_verified', models.BooleanField(default=False, help_text='Whether hashes have been verified to match')),
                ('hash_verified_at', models.DateTimeField(blank=True, null=True)),
                ('post_verification_passed', models.BooleanField(blank=True, help_text='Post-acquisition ewfverify result', null=True)),
                ('post_verification_at', models.DateTimeField(blank=True, help_text='When post-verification was performed', null=True)),
                ('ewf_format', models.CharField(blank=True, help_text='EWF format (encase5, encase6, etc)', max_length=50, null=True)),
                ('ewf_compression', models.CharField(blank=True, max_length=50, null=True)),
                ('ewf_sector_count', models.BigIntegerField(blank=True, null=True)),
                ('ewf_bytes_per_sector', models.IntegerField(blank=True, null=True)),
                ('ewf_media_size', models.BigIntegerField(blank=True, null=True)),
                ('ewf_chunk_size', models.IntegerField(blank=True, null=True)),
                ('ewf_guid', models.CharField(blank=True, help_text='GUID from EWF metadata', max_length=36, null=True)),
                ('ewf_acquiry_date', models.DateTimeField(blank=True, null=True)),
                ('forensic_documentation_complete', models.BooleanField(default=False, help_text='All forensic documentation completed')),
                ('qa_review_required', models.BooleanField(default=True, help_text='Does this job require QA review?')),
                ('qa_review_completed', models.BooleanField(default=False)),
                ('integrity_verified', models.BooleanField(default=False, help_text='Cryptographic integrity verification performed')),
                ('integrity_verified_at', models.DateTimeField(blank=True, help_text='When integrity verification was performed', null=True)),
                ('integrity_valid', models.BooleanField(blank=True, help_text='Result of integrity verification', null=True)),
                ('integrity_report', models.JSONField(blank=True, default=dict, help_text='Full integrity verification report')),
                ('agent', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='jobs', to='imager.agent')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='jobs_created', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='evidencehandlingevent',
            name='job',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='handling_events', to='imager.imagingjob'),
        ),
        migrations.CreateModel(
            name='JobLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('level', models.CharField(choices=[('info', 'Info'), ('warning', 'Warning'), ('error', 'Error')], default='info', max_length=10)),
                ('message', models.TextField()),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
                ('record_hash', models.CharField(blank=True, editable=False, help_text='SHA256 hash of this record for tamper detection', max_length=64)),
                ('previous_hash', models.CharField(blank=True, editable=False, help_text='Hash of previous record in chain for this job', max_length=64)),
                ('job', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='logs', to='imager.imagingjob')),
            ],
            options={
                'ordering': ['timestamp'],
            },
        ),
        migrations.CreateModel(
            name='MobileDevice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('device_type', models.CharField(choices=[('ios', 'iOS (iPhone/iPad)'), ('android', 'Android')], max_length=20)),
                ('serial_number', models.CharField(db_index=True, help_text='Device serial number or UDID', max_length=100)),
                ('udid', models.CharField(blank=True, help_text='iOS UDID or Android serial (same as serial_number for Android)', max_length=100)),
                ('model', models.CharField(blank=True, help_text='Device model (e.g., iPhone 13, Pixel 6)', max_length=100)),
                ('manufacturer', models.CharField(blank=True, help_text='Apple, Samsung, Google, etc.', max_length=100)),
                ('product_type', models.CharField(blank=True, help_text='iOS: iPhone13,2 | Android: SM-G998B', max_length=100)),
                ('os_version', models.CharField(blank=True, help_text='iOS 17.1.1 or Android 13', max_length=50)),
                ('build_version', models.CharField(blank=True, help_text='Detailed build number', max_length=100)),
                ('connection_status', models.CharField(choices=[('connected', 'Connected'), ('disconnected', 'Disconnected'), ('extracting', 'Extracting')], default='disconnected', max_length=20)),
                ('is_locked', models.BooleanField(default=True, help_text='Device has passcode/pattern lock active')),
                ('is_encrypted', models.BooleanField(default=True, help_text='Device storage is encrypted')),
                ('is_jailbroken', models.BooleanField(default=False, help_text='iOS: Jailbroken | Android: Rooted')),
                ('usb_debugging_enabled', models.BooleanField(default=False, help_text='Android: USB debugging is enabled')),
                ('developer_mode_enabled', models.BooleanField(default=False, help_text='Android: Developer options enabled')),
                ('first_seen', models.DateTimeField(auto_now_add=True)),
                ('last_seen', models.DateTimeField(auto_now=True)),
                ('device_name', models.CharField(blank=True, help_text="User-assigned name (e.g., 'John's iPhone')", max_length=200)),
                ('imei', models.CharField(blank=True, help_text='International Mobile Equipment Identity', max_length=20)),
                ('imei2', models.CharField(blank=True, help_text='Second IMEI for dual-SIM devices', max_length=20)),
                ('phone_number', models.CharField(blank=True, help_text='Phone number if detectable', max_length=20)),
                ('iccid', models.CharField(blank=True, help_text='SIM card Integrated Circuit Card ID', max_length=30)),
                ('wifi_mac', models.CharField(blank=True, help_text='WiFi MAC address', max_length=17)),
                ('bluetooth_mac', models.CharField(blank=True, help_text='Bluetooth MAC address', max_length=17)),
                ('battery_level', models.IntegerField(blank=True, help_text='Battery percentage (0-100)', null=True)),
                ('battery_state', models.CharField(blank=True, help_text='charging, full, unplugged', max_length=20)),
                ('storage_total_bytes', models.BigIntegerField(blank=True, help_text='Total storage in bytes', null=True)),
                ('storage_used_bytes', models.BigIntegerField(blank=True, help_text='Used storage in bytes', null=True)),
                ('ios_device_class', models.CharField(blank=True, help_text='iPhone, iPad, iPod', max_length=50)),
                ('ios_hardware_model', models.CharField(blank=True, help_text='N71mAP (internal model)', max_length=50)),
                ('ios_device_color', models.CharField(blank=True, max_length=50)),
                ('ios_region_info', models.CharField(blank=True, help_text='LL/A (US), etc.', max_length=10)),
                ('android_sdk_version', models.IntegerField(blank=True, help_text='Android SDK API level', null=True)),
                ('android_security_patch', models.CharField(blank=True, help_text='Security patch level date', max_length=20)),
                ('android_fingerprint', models.CharField(blank=True, help_text='Build fingerprint', max_length=500)),
                ('device_info_json', models.JSONField(blank=True, default=dict, help_text='Complete raw device information')),
                ('connected_agent', models.ForeignKey(blank=True, help_text='Agent this device is currently connected to', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='connected_mobile_devices', to='imager.agent')),
            ],
            options={
                'ordering': ['-last_seen'],
            },
        ),
        migrations.CreateModel(
            name='MobileExtractionJob',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('extraction_method', models.CharField(choices=[('logical', 'Logical Backup')], default='logical', help_text='Extraction method to use', max_length=30)),
                ('backup_encrypted', models.BooleanField(default=False, help_text='iOS: Backup is encrypted')),
                ('backup_password', models.CharField(blank=True, help_text='iOS: Encrypted backup password (stored temporarily)', max_length=200)),
                ('include_app_data', models.BooleanField(default=True, help_text='Include application data')),
                ('include_photos', models.BooleanField(default=True, help_text='Include photos/videos')),
                ('include_messages', models.BooleanField(default=True, help_text='Include messages (SMS/iMessage)')),
                ('include_internal_storage', models.BooleanField(default=True, help_text='Android: Include internal storage')),
                ('include_sd_card', models.BooleanField(default=False, help_text='Android: Include SD card if present')),
                ('include_system_partition', models.BooleanField(default=False, help_text='Android: Include /system partition')),
                ('extraction_started_at', models.DateTimeField(blank=True, null=True)),
                ('extraction_completed_at', models.DateTimeField(blank=True, null=True)),
                ('extraction_size_bytes', models.BigIntegerField(blank=True, help_text='Total size of extraction', null=True)),
                ('files_extracted', models.IntegerField(blank=True, help_text='Number of files extracted', null=True)),
                ('apps_extracted', models.JSONField(blank=True, default=list, help_text='List of apps/packages extracted')),
                ('databases_found', models.JSONField(blank=True, default=list, help_text='SQLite databases found')),
                ('contacts_count', models.IntegerField(blank=True, null=True)),
                ('messages_count', models.IntegerField(blank=True, null=True)),
                ('call_logs_count', models.IntegerField(blank=True, null=True)),
                ('photos_count', models.IntegerField(blank=True, null=True)),
                ('videos_count', models.IntegerField(blank=True, null=True)),
                ('device_owner', models.CharField(blank=True, help_text='Person or entity who owns/uses this device', max_length=255)),
                ('device_context', models.CharField(blank=True, help_text='How this device relates to the investigation', max_length=500)),
                ('extraction_notes', models.TextField(blank=True, help_text='Notes about the extraction process, consent, circumstances')),
                ('backup_name', models.CharField(blank=True, help_text='Custom name for the backup directory', max_length=255)),
                ('imaging_job', models.OneToOneField(help_text='Parent imaging job', on_delete=django.db.models.deletion.CASCADE, related_name='mobile_extraction', to='imager.imagingjob')),
                ('mobile_device', models.ForeignKey(help_text='Mobile device being extracted', on_delete=django.db.models.deletion.CASCADE, related_name='extraction_jobs', to='imager.mobiledevice')),
            ],
            options={
                'ordering': ['-extraction_started_at'],
            },
        ),
        migrations.CreateModel(
            name='NFSServer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Descriptive name for this NFS server', max_length=255, unique=True)),
                ('server', models.CharField(help_text='NFS server hostname or IP address', max_length=255)),
                ('share', models.CharField(help_text='NFS share path (e.g., /mnt/forensics)', max_length=500)),
                ('mount_point', models.CharField(default='/mnt/nfs-share', help_text='Local mount point on agent', max_length=500)),
                ('nfs_version', models.CharField(blank=True, default='4', help_text='NFS version (3, 4, 4.1, etc.)', max_length=10)),
                ('mount_options', models.CharField(blank=True, help_text='Additional mount options (e.g., rw,sync,hard)', max_length=500, null=True)),
                ('is_active', models.BooleanField(default=True, help_text='Whether this server is available for selection')),
                ('description', models.TextField(blank=True, help_text='Notes about this NFS server', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='nfs_servers_created', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'NFS Server',
                'verbose_name_plural': 'NFS Servers',
                'ordering': ['name'],
            },
        ),
        migrations.AddField(
            model_name='imagingjob',
            name='nfs_server_config',
            field=models.ForeignKey(blank=True, help_text='Pre-configured NFS server', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='jobs', to='imager.nfsserver'),
        ),
        migrations.CreateModel(
            name='QAReview',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('review_status', models.CharField(choices=[('pending', 'Pending Review'), ('in_review', 'In Review'), ('approved', 'Approved'), ('requires_correction', 'Requires Correction'), ('rejected', 'Rejected')], default='pending', max_length=50)),
                ('review_started_at', models.DateTimeField(blank=True, null=True)),
                ('review_completed_at', models.DateTimeField(blank=True, null=True)),
                ('hash_verification_checked', models.BooleanField(default=False, help_text='Hash values verified')),
                ('hash_verification_passed', models.BooleanField(default=False)),
                ('hash_verification_notes', models.TextField(blank=True)),
                ('metadata_verified', models.BooleanField(default=False, help_text='Metadata completeness checked')),
                ('metadata_complete', models.BooleanField(default=False)),
                ('metadata_notes', models.TextField(blank=True)),
                ('documentation_checked', models.BooleanField(default=False, help_text='Documentation reviewed')),
                ('documentation_complete', models.BooleanField(default=False)),
                ('documentation_notes', models.TextField(blank=True)),
                ('chain_of_custody_checked', models.BooleanField(default=False)),
                ('chain_of_custody_intact', models.BooleanField(default=False)),
                ('chain_of_custody_notes', models.TextField(blank=True)),
                ('write_blocker_checked', models.BooleanField(default=False)),
                ('write_blocker_verified', models.BooleanField(default=False)),
                ('write_blocker_notes', models.TextField(blank=True)),
                ('image_integrity_checked', models.BooleanField(default=False)),
                ('image_integrity_verified', models.BooleanField(default=False)),
                ('image_integrity_notes', models.TextField(blank=True)),
                ('all_checks_passed', models.BooleanField(default=False)),
                ('reviewer_comments', models.TextField(blank=True, help_text='Overall review comments')),
                ('corrections_required', models.TextField(blank=True, help_text='List corrections needed')),
                ('final_approval', models.BooleanField(default=False)),
                ('final_approval_date', models.DateTimeField(blank=True, null=True)),
                ('final_approval_notes', models.TextField(blank=True)),
                ('corrections_made', models.BooleanField(default=False)),
                ('corrections_description', models.TextField(blank=True)),
                ('re_review_required', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('final_approval_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='qa_final_approvals', to=settings.AUTH_USER_MODEL)),
                ('job', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='qa_review', to='imager.imagingjob')),
                ('reviewed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='qa_reviews_performed', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'QA Review',
                'verbose_name_plural': 'QA Reviews',
            },
        ),
        migrations.CreateModel(
            name='RemoteShellSession',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('session_id', models.CharField(db_index=True, max_length=64, unique=True)),
                ('started_at', models.DateTimeField(auto_now_add=True)),
                ('ended_at', models.DateTimeField(blank=True, null=True)),
                ('last_activity', models.DateTimeField(auto_now=True)),
                ('status', models.CharField(choices=[('active', 'Active'), ('closed', 'Closed'), ('terminated', 'Terminated')], default='active', max_length=20)),
                ('ip_address', models.GenericIPAddressField()),
                ('user_agent', models.TextField(blank=True, null=True)),
                ('command_count', models.IntegerField(default=0)),
                ('transcript_path', models.CharField(blank=True, help_text='Path to full session transcript', max_length=500, null=True)),
                ('agent', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='shell_sessions', to='imager.agent')),
                ('user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='shell_sessions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-started_at'],
            },
        ),
        migrations.CreateModel(
            name='ShellCommand',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('command', models.TextField(help_text='Command executed')),
                ('output', models.TextField(blank=True, help_text='Command output (truncated if too long)')),
                ('exit_code', models.IntegerField(blank=True, null=True)),
                ('executed_at', models.DateTimeField(auto_now_add=True)),
                ('duration_ms', models.IntegerField(blank=True, help_text='Execution time in milliseconds', null=True)),
                ('session', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='commands', to='imager.remoteshellsession')),
            ],
            options={
                'ordering': ['executed_at'],
            },
        ),
        migrations.CreateModel(
            name='SourceDevice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('manufacturer', models.CharField(blank=True, help_text='e.g., Samsung, Western Digital', max_length=255)),
                ('model_number', models.CharField(blank=True, max_length=255)),
                ('serial_number', models.CharField(blank=True, max_length=255)),
                ('firmware_version', models.CharField(blank=True, max_length=100)),
                ('capacity_bytes', models.BigIntegerField(blank=True, null=True)),
                ('capacity_formatted', models.CharField(blank=True, help_text='e.g., 500GB', max_length=50)),
                ('device_type', models.CharField(choices=[('hdd', 'Hard Disk Drive'), ('ssd', 'Solid State Drive'), ('usb', 'USB Flash Drive'), ('sd_card', 'SD Card'), ('phone', 'Mobile Phone'), ('tablet', 'Tablet'), ('computer', 'Computer'), ('other', 'Other')], default='hdd', max_length=50)),
                ('interface_type', models.CharField(blank=True, help_text='SATA, USB 3.0, NVMe, etc.', max_length=50)),
                ('physical_condition', models.TextField(help_text='Describe physical condition, damage, wear')),
                ('damage_documented', models.BooleanField(default=False)),
                ('damage_description', models.TextField(blank=True)),
                ('smart_status', models.CharField(choices=[('passed', 'PASSED'), ('failed', 'FAILED'), ('not_available', 'N/A')], default='not_available', max_length=20)),
                ('power_on_hours', models.IntegerField(blank=True, null=True)),
                ('power_cycle_count', models.IntegerField(blank=True, null=True)),
                ('reallocated_sectors', models.IntegerField(blank=True, null=True)),
                ('pending_sectors', models.IntegerField(blank=True, null=True)),
                ('uncorrectable_sectors', models.IntegerField(blank=True, null=True)),
                ('smart_data_json', models.JSONField(default=dict, help_text='Full SMART data dump')),
                ('evidence_bag_number', models.CharField(blank=True, max_length=100)),
                ('evidence_seal_number', models.CharField(blank=True, max_length=100)),
                ('sealed_at', models.DateTimeField(blank=True, null=True)),
                ('storage_location', models.CharField(blank=True, help_text='Evidence locker, room number, etc.', max_length=255)),
                ('device_photos', models.JSONField(default=list, help_text='List of device photo URLs')),
                ('label_photos', models.JSONField(default=list, help_text='Photos of labels/serial numbers')),
                ('damage_photos', models.JSONField(default=list, help_text='Photos of damage')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('job', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='source_device', to='imager.imagingjob')),
                ('sealed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sealed_evidence', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Source Device',
                'verbose_name_plural': 'Source Devices',
            },
        ),
        migrations.AddField(
            model_name='imagingjob',
            name='ssh_keys',
            field=models.ManyToManyField(blank=True, help_text='SSH public keys to authorize on agent', related_name='jobs', to='imager.sshkey'),
        ),
        migrations.CreateModel(
            name='SystemSettings',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('enable_chain_of_custody', models.BooleanField(default=False, help_text='Enable chain of custody tracking (evidence handling events, timeline)')),
                ('enable_qa_review', models.BooleanField(default=False, help_text='Enable quality assurance review workflow')),
                ('enable_qr_codes', models.BooleanField(default=False, help_text='Enable QR code generation for evidence labels')),
                ('enable_digital_signatures', models.BooleanField(default=False, help_text='Enable digital signatures for evidence events')),
                ('enable_webhooks', models.BooleanField(default=True, help_text='Enable webhook notifications (Slack, Teams, etc.)')),
                ('enable_email_notifications', models.BooleanField(default=True, help_text='Enable email notifications for job completion')),
                ('enable_remote_shell', models.BooleanField(default=True, help_text='Enable SSH terminal access to agents via web UI')),
                ('enable_integrity_monitoring', models.BooleanField(default=True, help_text='Enable periodic integrity verification of audit logs and chain of custody')),
                ('integrity_check_interval_minutes', models.PositiveIntegerField(default=60, help_text='How often to run integrity checks (in minutes)')),
                ('tamper_alert_webhook_url', models.URLField(blank=True, help_text='Webhook URL for tampering alerts (Slack, Discord, Teams, etc.)', null=True)),
                ('tamper_alert_email', models.EmailField(blank=True, help_text='Email address for tampering alerts', max_length=254, null=True)),
                ('last_integrity_check', models.DateTimeField(blank=True, help_text='Timestamp of last integrity verification', null=True)),
                ('last_integrity_status', models.BooleanField(default=True, help_text='Result of last integrity check (True=passed, False=tampering detected)')),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('updated_by', models.ForeignKey(blank=True, help_text='Last user who modified these settings', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'System Settings',
                'verbose_name_plural': 'System Settings',
            },
        ),
        migrations.CreateModel(
            name='UserProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('role', models.CharField(choices=[('admin', 'Administrator'), ('examiner', 'Examiner'), ('viewer', 'Viewer')], default='viewer', max_length=20)),
                ('department', models.CharField(blank=True, max_length=255, null=True)),
                ('phone', models.CharField(blank=True, max_length=50, null=True)),
                ('email_notifications', models.BooleanField(default=True)),
                ('slack_webhook_url', models.URLField(blank=True, help_text='Personal Slack webhook for notifications', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['user__username'],
            },
        ),
        migrations.CreateModel(
            name='WebhookConfig',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Descriptive name for this webhook', max_length=255)),
                ('webhook_type', models.CharField(choices=[('slack', 'Slack'), ('teams', 'Microsoft Teams'), ('google_chat', 'Google Chat'), ('generic', 'Generic Webhook')], max_length=20)),
                ('url', models.URLField(help_text='Webhook URL')),
                ('events', models.JSONField(default=list, help_text='List of events to trigger this webhook')),
                ('is_active', models.BooleanField(default=True)),
                ('send_progress_updates', models.BooleanField(default=False, help_text='Send progress updates (can be noisy)')),
                ('progress_interval', models.IntegerField(default=10, help_text='Only send progress every N percent')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_triggered', models.DateTimeField(blank=True, null=True)),
                ('success_count', models.IntegerField(default=0)),
                ('failure_count', models.IntegerField(default=0)),
                ('agent_filter', models.ForeignKey(blank=True, help_text='Only trigger for specific agent (optional)', null=True, on_delete=django.db.models.deletion.SET_NULL, to='imager.agent')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='webhooks_created', to=settings.AUTH_USER_MODEL)),
                ('user_filter', models.ForeignKey(blank=True, help_text='Only trigger for jobs created by specific user (optional)', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='WriteBlockerVerification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('write_blocker_used', models.BooleanField(default=True, help_text='Was a write-blocker used?')),
                ('write_blocker_model', models.CharField(help_text='e.g., Tableau T8-R2', max_length=255)),
                ('write_blocker_serial', models.CharField(blank=True, help_text='Serial number of device', max_length=255)),
                ('write_blocker_type', models.CharField(choices=[('hardware', 'Hardware Write Blocker'), ('software', 'Software Write Blocker'), ('none', 'No Write Blocker Used')], default='hardware', max_length=50)),
                ('pre_test_performed', models.BooleanField(default=False, help_text='Was write-blocking test performed?')),
                ('pre_test_passed', models.BooleanField(default=False, help_text='Did the test pass?')),
                ('pre_test_timestamp', models.DateTimeField(blank=True, null=True)),
                ('pre_test_method', models.TextField(blank=True, help_text='How was the test performed?')),
                ('write_operations_detected', models.IntegerField(default=0, help_text='Number of write ops detected (should be 0)')),
                ('write_blocker_verified', models.BooleanField(default=False, help_text='Write-blocker verified during imaging')),
                ('post_verification_performed', models.BooleanField(default=False)),
                ('post_verification_passed', models.BooleanField(default=False)),
                ('post_verification_notes', models.TextField(blank=True)),
                ('test_results', models.TextField(blank=True, help_text='Detailed test results')),
                ('photos', models.JSONField(default=list, help_text='Photos of write-blocker setup')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('job', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='write_blocker', to='imager.imagingjob')),
                ('pre_test_performed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='write_blocker_tests', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Write Blocker Verification',
                'verbose_name_plural': 'Write Blocker Verifications',
            },
        ),
        migrations.CreateModel(
            name='AuditLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('username', models.CharField(help_text='Username at time of action', max_length=150)),
                ('action', models.CharField(choices=[('login', 'User Login'), ('logout', 'User Logout'), ('agent_approve', 'Agent Approved'), ('agent_deny', 'Agent Denied'), ('agent_delete', 'Agent Deleted'), ('job_create', 'Job Created'), ('job_cancel', 'Job Cancelled'), ('job_delete', 'Job Deleted'), ('ssh_create', 'SSH Key Created'), ('ssh_delete', 'SSH Key Deleted'), ('webhook_create', 'Webhook Created'), ('webhook_delete', 'Webhook Deleted'), ('user_create', 'User Created'), ('user_update', 'User Updated'), ('user_delete', 'User Deleted'), ('shell_access', 'Remote Shell Access'), ('config_change', 'Configuration Changed')], max_length=50)),
                ('description', models.TextField(help_text='Detailed description of the action')),
                ('timestamp', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True, null=True)),
                ('object_id', models.PositiveIntegerField(blank=True, null=True)),
                ('extra_data', models.JSONField(blank=True, default=dict, help_text='Additional context as JSON')),
                ('record_hash', models.CharField(blank=True, editable=False, help_text='SHA256 hash of this record for tamper detection', max_length=64)),
                ('previous_hash', models.CharField(blank=True, editable=False, help_text='Hash of previous record in chain', max_length=64)),
                ('content_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='contenttypes.contenttype')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='audit_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['-timestamp', 'user'], name='imager_audi_timesta_aa3d11_idx'), models.Index(fields=['action', '-timestamp'], name='imager_audi_action_6d9c88_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='mobiledevice',
            index=models.Index(fields=['device_type', 'connection_status'], name='imager_mobi_device__710f20_idx'),
        ),
        migrations.AddIndex(
            model_name='mobiledevice',
            index=models.Index(fields=['serial_number'], name='imager_mobi_serial__eeff77_idx'),
        ),
        migrations.AddIndex(
            model_name='remoteshellsession',
            index=models.Index(fields=['agent', '-started_at'], name='imager_remo_agent_i_017b04_idx'),
        ),
        migrations.AddIndex(
            model_name='remoteshellsession',
            index=models.Index(fields=['user', '-started_at'], name='imager_remo_user_id_b893f3_idx'),
        ),
    ]
